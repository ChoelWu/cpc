define(function(require){require("common");var c=require("/static/lib/popplay/index.js"),a=require("./search"),h=null,w=$(".js-search-tips"),k=$(".js-search-ipt"),y={initScroll:function(){var c=$(".js-search-header"),a=c.offset().top+c.outerHeight(!0);$(window).scroll(function(){var h=$(window).scrollTop();return h>a?(c.addClass("fixed"),$(".js-header-placeholder").show(),!1):($(".js-header-placeholder").hide(),void c.removeClass("fixed"))})},initSwiper:function(){var c=new Swiper(".swiper-container",{slidesPerView:1,autoplay:{delay:3e3,disableOnInteraction:!1},spaceBetween:30,slidesPerGroup:1,loop:!0,loopFillGroupWithBlank:!0,pagination:{el:".swiper-pagination",clickable:!0},navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"}});$(".swiper-container").on("mouseenter",function(){c.autoplay.stop()}).on("mouseleave",function(){c.autoplay.start()})},initChapterMoreBtn:function(){$.each($(".js-all-chapter-con"),function(c,a){var h=$(a).find(".js-all-chapter");h.height()>76&&$(a).find(".js-all-chapter-btn").css({display:"flex"})})},watchSearchInput:function(){var c=k.val();return""==c?(a.setSearchHistory(),!1):(w.hide(),void(h=setTimeout(function(){a.associative(c)},500)))},submit:function(){var c=k.val();return""==c?void window.location.reload():void a.location(c)},showAllContentList:function(){var c=$(this).parent(),a=$(this).find("span"),h=$(this).find("i"),w=c.find(".content-course-free-chapter").height(),k=Boolean(c.data("slide"));k?(a.text("隐藏"),h.removeClass("imv2-arrow2_d").addClass("imv2-arrow2_u"),c.animate({height:w},300).data("slide",0)):(a.text("展开"),h.removeClass("imv2-arrow2_u").addClass("imv2-arrow2_d"),c.animate({height:76},300).data("slide",1))},reportHistoryWhenClick:function(){$(".js-wenda-title").on("click",function(){$.post("/search/clickhistory ",{wordid:__wordid}),$(this).parents(".js-wenda-item").find(".js-wenda-title").css("color","#7F7F7F")}),$(".js-article-title").on("click",function(){$.post("/search/clickhistory ",{wordid:__wordid}),$(this).parents(".js-article-item").find(".js-article-title").css("color","#7F7F7F")}),$(".js-wiki-title").on("click",function(){$.post("/search/clickhistory ",{wordid:__wordid}),$(this).parents(".js-wiki-item").find(".js-wiki-title").css("color","#7F7F7F")}),$(".js-recommend-statistics").on("click",function(){$.post("/search/clickhistory",{wordid:__wordid||0,recommend_id:$(this).data("rid")||0}),$(this).parents(".js-search-item").find(".js-item-title").css("color","#7F7F7F")}),$(".js-result-item").on("click",function(){$.post("/search/clickhistory ",{wordid:__wordid}),$(this).parents(".js-search-item").find(".js-item-title").css("color","#7F7F7F")})},bindZhuge:function(){var c={index:"全站","index-course":"课程","index-column":"专栏",wenda:"猿问",article:"手记",wiki:"wiki",content:"全部","content-www":"课程","content-shizhan":"实战","content-column":"专栏"},a=OP_CONFIG.page+(curr_type?"-"+curr_type:"");zhuge.track("Search",{KeyWord:OP_CONFIG.$words,Platform:"web"}),$("#main").on("click",".js-zhuge-allResult, .js-zhuge-allResult img, .js-zhuge-allResult a",function(){OP_CONFIG.$correctWords?zhuge.track("CorrectResult",{keywords:OP_CONFIG.$words,Platform:"web",CorrectWords:OP_CONFIG.$correctWords}):zhuge.track("AllResult",{KeyWord:OP_CONFIG.$words,Platform:"web",Source:c[a]})}).on("click",".js-zhuge-contentResult, .js-zhuge-contentResult img",function(){zhuge.track("ContentResult",{KeyWord:OP_CONFIG.$words,Platform:"web",Source:c[a]})}).on("click",".js-zhuge-searchAd a",function(){zhuge.track("SearchAd",{KeyWord:OP_CONFIG.$words,Platform:"web"})}).on("click",".js-zhuge-searchRecommend a",function(){zhuge.track("SearchRecommend",{KeyWord:OP_CONFIG.$words,Platform:"web"})}).on("click",".js-zhuge-searchHot a",function(){var c=this;zhuge.track("SearchHot",{KeyWord:OP_CONFIG.$words,Platform:"web"},function(){location.href=$(c).data("link")})}).on("click",".js-zhuge-keywordFeedback",function(){return $(this).hasClass("cant")?!1:($(this).addClass("cant"),$.alert("感谢您的反馈"),void zhuge.track("KeywordFeedback",{KeyWord:OP_CONFIG.$words,Platform:"web"}))})}},j=function(){k.on("input focus",function(){y.watchSearchInput()}).on("keyup",function(e){k.val();13==e.keyCode&&y.submit(),a.watchUpDown(e.keyCode)}).on("keydown",function(){clearTimeout(h)}).on("blur",function(){clearTimeout(h),setTimeout(function(){w.hide()},500)}),$(".js-search-btn").on("click",y.submit),$(".js-all-chapter-btn").on("click",y.showAllContentList),$("#main").on("click",".js-free-pop",v)},g=function(){y.initScroll(),y.initSwiper(),y.reportHistoryWhenClick(),y.bindZhuge(),"content"==OP_CONFIG.page&&y.initChapterMoreBtn(),j()},v=function(){var c=$(this).data("m"),a=$(this).data("c"),h=0,w=$.Deferred(),k=$.Deferred();OP_CONFIG.userInfo?C(w,"buy",a):C(k,"play",a),w.done(function(h){if(1==h.data){var w=window.open();w.location.href="//coding.imooc.com/lesson/"+a+".html#mid="+c}else C(k,"play",a)}),k.done(function(c){1===c.result&&F(a,c.data,h)})},C=function(c,a,h){if(a&&"string"==typeof a){var w,k,y,j;w="//coding.imooc.com","buy"===a?(y={cid:h},k=w+"/lesson/isbuyed",j="POST"):"play"===a&&(k=w+"/class/api_freelook?cid="+h,j="GET"),$.ajax({url:k,type:j,dataType:"json",data:y,xhrFields:{withCredentials:!0},crossDomain:!0,success:function(a){c.resolve(a)},fail:function(a){c.reject(a)}})}},F=function(a,h,w){c({course:a,targetCurrent:w,mediaSourceList:h,onMounted:function(e){$("body").css({position:"fixed",left:0,right:0}),$(".js-godetails").attr("href","//coding.imooc.com/class/"+a+".html").show()},onClose:function(e){$("body").removeAttr("style"),$(".js-godetails").hide()}})};g()});